package com.axellience.vuegwt.core.client;

import elemental2.dom.DomGlobal;
import elemental2.dom.HTMLScriptElement;
import jsinterop.base.JsPropertyMap;

class VueCustomElementLibInjector
{
    static void ensureInjected()
    {
        if (isCustomElementInjected())
            return;

        HTMLScriptElement scriptElement =
            (HTMLScriptElement) DomGlobal.document.createElement("script");
        scriptElement.text = VUE_CUSTOM_ELEMENT;
        DomGlobal.document.body.appendChild(scriptElement);
    }

    private static boolean isCustomElementInjected()
    {
        return ((JsPropertyMap) DomGlobal.window).get("VueCustomElement") != null;
    }

    /**
     * vue-custom-element v1.4.2
     * (c) 2017 Karol FabjaÅ„czuk
     * Modified by Adrien Baron
     * @license MIT
     */
    private static String VUE_CUSTOM_ELEMENT = "!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define(t):e.VueCustomElement=t()}(this,function(){\"use strict\";function e(e,t){return e.__proto__=t,e}function t(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}function n(){return Reflect.construct(HTMLElement,[],this.__proto__.constructor)}function o(e){function o(){!0===i.shadow&&HTMLElement.prototype.attachShadow&&this.attachShadow({mode:\"open\"}),\"function\"==typeof i.constructorCallback&&i.constructorCallback.call(this)}function c(){\"function\"==typeof i.connectedCallback&&i.connectedCallback.call(this)}function a(){\"function\"==typeof i.disconnectedCallback&&i.disconnectedCallback.call(this)}function r(e,t,n){\"function\"==typeof i.attributeChangedCallback&&i.attributeChangedCallback.call(this,e,t,n)}var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(\"undefined\"!=typeof customElements){if(f){var u=function(e){function c(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,c);var a=t(this,(c.__proto__||Object.getPrototypeOf(c)).call(this)),r=e?HTMLElement.call(e):a;return o.call(r),n=r,t(a,n)}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(c,n),d(c,null,[{key:\"observedAttributes\",get:function(){return i.observedAttributes||[]}}]),c}();return u.prototype.connectedCallback=c,u.prototype.disconnectedCallback=a,u.prototype.attributeChangedCallback=r,customElements.define(e,u),u}var l=function(e){var t=e?HTMLElement.call(e):this;return o.call(t),t};return l.observedAttributes=i.observedAttributes||[],l.prototype=Object.create(HTMLElement.prototype,{constructor:{configurable:!0,writable:!0,value:l}}),l.prototype.connectedCallback=c,l.prototype.disconnectedCallback=a,l.prototype.attributeChangedCallback=r,customElements.define(e,l),l}}function c(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.length-t,o=new Array(n);n--;)o[n]=e[n+t];return o}function a(e){var t=e,n=[\"true\",\"false\"].indexOf(e)>-1,o=parseFloat(t,10),c=!isNaN(o)&&isFinite(t);return n?t=\"true\"===t:c&&(t=o),t}function r(e,t){if(e&&e.length)e.forEach(function(e){var n=h(e);-1===t.camelCase.indexOf(n)&&t.camelCase.push(n)});else if(e&&\"object\"===(void 0===e?\"undefined\":m(e)))for(var n in e){var o=h(n);-1===t.camelCase.indexOf(o)&&t.camelCase.push(o)}}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],n=[];return c(e).forEach(function(e){if(\"#text\"===e.nodeName)e.nodeValue.trim()&&n.push(t(\"span\",e.nodeValue));else if(\"#comment\"!==e.nodeName){var o=function(e){var t={};return c(e.attributes).forEach(function(e){t[\"vue-slot\"===e.nodeName?\"slot\":e.nodeName]=e.nodeValue}),t}(e),a={attrs:o,domProps:{innerHTML:e.innerHTML}};o.slot&&(a.slot=o.slot,o.slot=void 0),n.push(t(e.tagName,a))}}),n}function u(e,t){for(var n=arguments.length,o=Array(n>2?n-2:0),c=2;c<n;c++)o[c-2]=arguments[c];var a=function(e,t){var n={bubbles:!1,cancelable:!1,detail:t},o=void 0;return\"function\"==typeof window.CustomEvent?o=new CustomEvent(e,n):(o=document.createEvent(\"CustomEvent\")).initCustomEvent(e,n.bubbles,n.cancelable,n.detail),o}(t,[].concat(o));e.dispatchEvent(a)}function l(e,t,n,o,c){if(!e.__vue_custom_element__){var r=function(e,t,n){var o=t.propsData||{};return n.hyphenate.forEach(function(t,c){var r=e.attributes[t],i=n.camelCase[c];\"object\"!==(void 0===r?\"undefined\":m(r))||r instanceof Attr?r instanceof Attr&&r.value&&(o[i]=a(r.value)):o[i]=r}),o}(e,n.options,o),l=n.extend({beforeCreate:function(){this.$emit=function(){for(var t,n=arguments.length,o=Array(n),c=0;c<n;c++)o[c]=arguments[c];u.apply(void 0,[e].concat(o)),this.__proto__&&(t=this.__proto__.$emit).call.apply(t,[this].concat(o))}}}),s=e.cloneNode(!0).childNodes,f={propsData:r,props:o.camelCase,computed:{reactiveProps:function(){var e=this,t={};return o.camelCase.forEach(function(n){t[n]=e[n]}),t}},render:function(e){var t={props:this.reactiveProps};return e(l,t,i(s,e))}};if(c.shadow&&e.shadowRoot?(e.shadowRoot.innerHTML=\"<div></div>\",f.el=e.shadowRoot.children[0]):(e.innerHTML=\"<div></div>\",f.el=e.children[0]),function(e,t){t.camelCase.forEach(function(n,o){Object.defineProperty(e,n,{get:function(){return this.__vue_custom_element__[n]},set:function(e){if(\"object\"!==(void 0===e?\"undefined\":m(e))&&\"function\"!=typeof e||!this.__vue_custom_element__)this.setAttribute(t.hyphenate[o],a(e));else{var n=t.camelCase[o];this.__vue_custom_element__[n]=e}}})})}(e,o),e.__vue_custom_element__=new t(f),c.shadow&&c.shadowCss&&e.shadowRoot){var d=document.createElement(\"style\");d.type=\"text/css\",d.appendChild(document.createTextNode(c.shadowCss)),e.shadowRoot.appendChild(d)}e.removeAttribute(\"vce-cloak\"),e.setAttribute(\"vce-ready\",\"\"),u(e,\"vce-ready\")}}function s(e){e.customElement=function(t,n){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=function(e){var t={camelCase:[],hyphenate:[]},n=e.options;return n?(n.mixins&&n.mixins.forEach(function(e){r(e.props,t)}),r(n.props,t),t.camelCase.forEach(function(e){t.hyphenate.push(_(e))}),t):t}(n);return o(t,{constructorCallback:function(){\"function\"==typeof c.constructorCallback&&c.constructorCallback.call(this)},connectedCallback:function(){this.__detached__||l(this,e,n,i,c),\"function\"==typeof c.connectedCallback&&c.connectedCallback.call(this),this.__detached__=!1},disconnectedCallback:function(){var e=this;this.__detached__=!0,\"function\"==typeof c.disconnectedCallback&&c.disconnectedCallback.call(this),setTimeout(function(){e.__detached__&&e.__vue_custom_element__&&e.__vue_custom_element__.$destroy(!0)},c.destroyTimeout||3e3)},attributeChangedCallback:function(e,t,n){if(this.__vue_custom_element__&&void 0!==n){var o=h(e);\"function\"==typeof c.attributeChangedCallback&&c.attributeChangedCallback.call(this,e,t,n),this.__vue_custom_element__[o]=a(n)}},observedAttributes:i.hyphenate,shadow:!!c.shadow&&!!HTMLElement.prototype.attachShadow})}}Object.setPrototypeOf=Object.setPrototypeOf||e;e.bind(Object);var f=\"undefined\"!=typeof Symbol&&\"undefined\"!=typeof Reflect,d=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,\"value\"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();Object.setPrototypeOf(n.prototype,HTMLElement.prototype),Object.setPrototypeOf(n,HTMLElement);var p=/-(\\w)/g,h=function(e){return e.replace(p,function(e,t){return t?t.toUpperCase():\"\"})},b=/([^-])([A-Z])/g,_=function(e){return e.replace(b,\"$1-$2\").replace(b,\"$1-$2\").toLowerCase()},m=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e};return\"undefined\"!=typeof window&&window.Vue&&(window.Vue.use(s),s.installed&&(s.installed=!1)),s});";
}
